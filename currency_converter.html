<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Exchange Rate Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 800px; margin-top: 20px; }
        .exchange-rate { font-size: 24px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container text-center">
        <h2>Live Exchange Rate Tracker</h2>
        <p class="exchange-rate" id="exchangeRate">Loading...</p>
        
        <div class="card p-4 mt-3">
            <h4>Currency Converter</h4>
            <div class="mb-3">
                <input type="number" id="amount" class="form-control" placeholder="Enter amount" required>
            </div>
            <div class="mb-3">
                <select id="fromCurrency" class="form-control" onchange="updateExchangeRate()"></select>
            </div>
            <div class="mb-3">
                <select id="toCurrency" class="form-control" onchange="updateExchangeRate()"></select>
            </div>
            <button class="btn btn-primary w-100" onclick="convertCurrency()">Convert</button>
            <h4 class="mt-3" id="result"></h4>
        </div>
        
        <div class="card p-4 mt-3">
            <h4>Exchange Rate Trends (Last 30 Days)</h4>
            <canvas id="exchangeChart"></canvas>
        </div>
    </div>
    
    <script>
        const baseApiUrl = "https://api.exchangerate.host";
        let exchangeRates = {};

        async function fetchExchangeRates(baseCurrency = "USD") {
            try {
                const response = await fetch(`${baseApiUrl}/latest?base=${baseCurrency}`);
                const data = await response.json();
                exchangeRates = data.rates;
                populateCurrencySelectors();
                updateExchangeRate();
                fetchHistoricalData();
            } catch (error) {
                console.error("Error fetching exchange rates:", error);
                document.getElementById("exchangeRate").innerText = "Error fetching rates. Please try again later.";
            }
        }

        function populateCurrencySelectors() {
            const fromSelect = document.getElementById("fromCurrency");
            const toSelect = document.getElementById("toCurrency");
            fromSelect.innerHTML = "";
            toSelect.innerHTML = "";
            for (let currency in exchangeRates) {
                fromSelect.innerHTML += `<option value="${currency}">${currency}</option>`;
                toSelect.innerHTML += `<option value="${currency}">${currency}</option>`;
            }
            fromSelect.value = "USD";
            toSelect.value = "NGN";
        }

        function updateExchangeRate() {
            const fromCurrency = document.getElementById("fromCurrency").value;
            const toCurrency = document.getElementById("toCurrency").value;

            if (exchangeRates[fromCurrency] && exchangeRates[toCurrency]) {
                const rate = (exchangeRates[toCurrency] / exchangeRates[fromCurrency]).toFixed(4);
                document.getElementById("exchangeRate").innerText = `1 ${fromCurrency} = ${rate} ${toCurrency}`;
                fetchHistoricalData(fromCurrency, toCurrency);
            }
        }

        function convertCurrency() {
            const amount = document.getElementById("amount").value;
            const fromCurrency = document.getElementById("fromCurrency").value;
            const toCurrency = document.getElementById("toCurrency").value;
            if (!amount || amount <= 0) {
                alert("Please enter a valid amount.");
                return;
            }
            const rate = exchangeRates[toCurrency] / exchangeRates[fromCurrency];
            const convertedAmount = (amount * rate).toFixed(2);
            document.getElementById("result").innerText = `${amount} ${fromCurrency} = ${convertedAmount} ${toCurrency}`;
        }

        async function fetchHistoricalData(baseCurrency = "USD", targetCurrency = "NGN") {
            try {
                const today = new Date();
                const startDate = new Date();
                startDate.setDate(today.getDate() - 30);
                const formattedStartDate = startDate.toISOString().split('T')[0];
                const formattedEndDate = today.toISOString().split('T')[0];

                const historicalUrl = `${baseApiUrl}/timeseries?start_date=${formattedStartDate}&end_date=${formattedEndDate}&base=${baseCurrency}&symbols=${targetCurrency}`;
                const response = await fetch(historicalUrl);
                const data = await response.json();

                const dates = Object.keys(data.rates);
                const rates = dates.map(date => data.rates[date][targetCurrency]);

                renderChart(dates, rates, baseCurrency, targetCurrency);
            } catch (error) {
                console.error("Error fetching historical data:", error);
            }
        }

        function renderChart(dates, rates, baseCurrency, targetCurrency) {
            const ctx = document.getElementById("exchangeChart").getContext("2d");
            if (window.myChart) {
                window.myChart.destroy();
            }
            window.myChart = new Chart(ctx, {
                type: "line",
                data: {
                    labels: dates,
                    datasets: [{
                        label: `${baseCurrency} to ${targetCurrency}`,
                        data: rates,
                        borderColor: "blue",
                        fill: false
                    }]
                }
            });
        }

        fetchExchangeRates();
    </script>
</body>
</html>
