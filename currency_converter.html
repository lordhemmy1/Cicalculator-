<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Exchange Rate Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 800px; margin-top: 20px; }
        .exchange-rate { font-size: 24px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container text-center">
        <h2>Live Exchange Rate Tracker</h2>
        <p class="exchange-rate" id="exchangeRate">Loading...</p>
        
        <div class="card p-4 mt-3">
            <h4>Currency Converter</h4>
            <div class="mb-3">
                <input type="number" id="amount" class="form-control" placeholder="Enter amount" required>
            </div>
            <div class="mb-3">
                <input type="text" id="fromCurrency" class="form-control" placeholder="Enter base currency (e.g., USD)">
            </div>
            <div class="mb-3">
                <input type="text" id="toCurrency" class="form-control" placeholder="Enter target currency (e.g., NGN)">
            </div>
            <button class="btn btn-primary w-100" onclick="convertCurrency()">Convert</button>
            <h4 class="mt-3" id="result"></h4>
        </div>
        
        <div class="card p-4 mt-3">
            <h4>Exchange Rate Trends (Last 30 Days)</h4>
            <canvas id="exchangeChart"></canvas>
        </div>
    </div>
    
    <script>
        const realTimeAPI = "https://api.exchangerate.host/latest";
        const historicalAPI = "https://api.exchangerate.host/timeseries?start_date=2024-03-01&end_date=2024-04-01&base=USD";
        let exchangeRates = {};

        async function fetchExchangeRates(base = "USD") {
            try {
                const response = await fetch(`${realTimeAPI}?base=${base}`);
                const data = await response.json();
                if (!data.rates) throw new Error("Invalid response from API");
                exchangeRates = data.rates;
                updateExchangeRate();
                fetchHistoricalData(base);
            } catch (error) {
                console.error("Error fetching exchange rates:", error);
                document.getElementById("exchangeRate").innerText = "Error fetching rates. Try again later.";
            }
        }

        function updateExchangeRate() {
            const fromCurrency = document.getElementById("fromCurrency").value.toUpperCase();
            const toCurrency = document.getElementById("toCurrency").value.toUpperCase();
            if (exchangeRates[fromCurrency] && exchangeRates[toCurrency]) {
                const rate = (exchangeRates[toCurrency] / exchangeRates[fromCurrency]).toFixed(4);
                document.getElementById("exchangeRate").innerText = `1 ${fromCurrency} = ${rate} ${toCurrency}`;
            } else {
                document.getElementById("exchangeRate").innerText = "Invalid currency pair!";
            }
        }

        function convertCurrency() {
            const amount = document.getElementById("amount").value;
            const fromCurrency = document.getElementById("fromCurrency").value.toUpperCase();
            const toCurrency = document.getElementById("toCurrency").value.toUpperCase();
            if (!amount || amount <= 0) {
                alert("Please enter a valid amount.");
                return;
            }
            if (exchangeRates[fromCurrency] && exchangeRates[toCurrency]) {
                const rate = exchangeRates[toCurrency] / exchangeRates[fromCurrency];
                const convertedAmount = (amount * rate).toFixed(2);
                document.getElementById("result").innerText = `${amount} ${fromCurrency} = ${convertedAmount} ${toCurrency}`;
            } else {
                document.getElementById("result").innerText = "Invalid currency pair!";
            }
        }

        async function fetchHistoricalData(base = "USD") {
            try {
                const response = await fetch(`${historicalAPI}&base=${base}`);
                const data = await response.json();
                if (!data.rates) {
                    console.error("No historical data found.");
                    return;
                }
                const dates = Object.keys(data.rates);
                const toCurrency = document.getElementById("toCurrency").value.toUpperCase();
                const rates = dates.map(date => data.rates[date][toCurrency] || 0);
                renderChart(dates, rates);
            } catch (error) {
                console.error("Error fetching historical data:", error);
            }
        }

        function renderChart(dates, rates) {
            const ctx = document.getElementById("exchangeChart").getContext("2d");
            new Chart(ctx, {
                type: "line",
                data: {
                    labels: dates,
                    datasets: [{
                        label: "Exchange Rate Trends",
                        data: rates,
                        borderColor: "blue",
                        fill: false
                    }]
                }
            });
        }

        fetchExchangeRates();
    </script>
</body>
</html>
