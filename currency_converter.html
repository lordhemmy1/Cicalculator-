<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Exchange Rate Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 800px; margin-top: 20px; }
        .exchange-rate { font-size: 24px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container text-center">
        <h2>Live Exchange Rate Tracker</h2>
        <p class="exchange-rate" id="exchangeRate">Loading...</p>
        
        <div class="card p-4 mt-3">
            <h4>Currency Converter</h4>
            <div class="mb-3">
                <input type="number" id="amount" class="form-control" placeholder="Enter amount" required>
            </div>
            <div class="mb-3">
                <select id="fromCurrency" class="form-control"></select>
            </div>
            <div class="mb-3">
                <select id="toCurrency" class="form-control"></select>
            </div>
            <button class="btn btn-primary w-100" onclick="convertCurrency()">Convert</button>
            <h4 class="mt-3" id="result"></h4>
        </div>
        
        <div class="card p-4 mt-3">
            <h4>Exchange Rate Trends (Last 30 Days)</h4>
            <canvas id="exchangeChart"></canvas>
        </div>
    </div>
    
    <script>
        const apiUrl = "https://api.exchangerate-api.com/v4/latest/USD";
        let exchangeRates = {};
        
        async function fetchExchangeRates() {
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                exchangeRates = data.rates;
                document.getElementById("exchangeRate").innerText = `1 USD = ${exchangeRates.NGN} NGN`;
                populateCurrencySelectors();
                fetchHistoricalData(); // Fetch historical data for the default pair (USD to NGN)
            } catch (error) {
                console.error("Error fetching exchange rates:", error);
                document.getElementById("exchangeRate").innerText = "Error fetching rates. Please try again later.";
            }
        }

        function populateCurrencySelectors() {
            const fromSelect = document.getElementById("fromCurrency");
            const toSelect = document.getElementById("toCurrency");
            fromSelect.innerHTML = "";
            toSelect.innerHTML = "";
            for (let currency in exchangeRates) {
                fromSelect.innerHTML += `<option value="${currency}">${currency}</option>`;
                toSelect.innerHTML += `<option value="${currency}">${currency}</option>`;
            }
            fromSelect.value = "USD";
            toSelect.value = "NGN";
        }

        function convertCurrency() {
            const amount = document.getElementById("amount").value;
            const fromCurrency = document.getElementById("fromCurrency").value;
            const toCurrency = document.getElementById("toCurrency").value;
            if (!amount || amount <= 0) {
                alert("Please enter a valid amount.");
                return;
            }
            const rate = exchangeRates[toCurrency] / exchangeRates[fromCurrency];
            const convertedAmount = (amount * rate).toFixed(2);
            document.getElementById("result").innerText = `${amount} ${fromCurrency} = ${convertedAmount} ${toCurrency}`;
            updateExchangeRateDisplay(fromCurrency, toCurrency);
        }

        function updateExchangeRateDisplay(fromCurrency, toCurrency) {
            const rate = exchangeRates[toCurrency] / exchangeRates[fromCurrency];
            document.getElementById("exchangeRate").innerText = `1 ${fromCurrency} = ${rate.toFixed(2)} ${toCurrency}`;
            fetchHistoricalData(fromCurrency, toCurrency); // Update chart based on selected pair
        }

        async function fetchHistoricalData(fromCurrency = "USD", toCurrency = "NGN") {
            try {
                // Fetch historical exchange rates for the last 30 days
                const historicalUrl = `https://api.exchangerate-api.com/v4/history/${fromCurrency}?start_date=2023-02-01&end_date=2023-03-01`; // Example date range
                const historicalResponse = await fetch(historicalUrl);
                const historicalData = await historicalResponse.json();
                const dates = Object.keys(historicalData.rates);
                const rates = dates.map(date => historicalData.rates[date][toCurrency]);
                renderChart(dates, rates);
            } catch (error) {
                console.error("Error fetching historical data:", error);
            }
        }

        function renderChart(dates, rates) {
            const ctx = document.getElementById("exchangeChart").getContext("2d");
            new Chart(ctx, {
                type: "line",
                data: {
                    labels: dates,
                    datasets: [{
                        label: `Exchange Rate (${dates[0]} to ${rates[0]})`,
                        data: rates,
                        borderColor: "blue",
                        fill: false
                    }]
                }
            });
        }

        fetchExchangeRates();
    </script>
</body>
</html>
